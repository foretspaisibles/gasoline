<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<link rel="stylesheet" href="style.css" type="text/css">
<meta content="text/html; charset=utf-8" http-equiv="Content-Type">
<link rel="Start" href="index.html">
<link rel="previous" href="ConfigurationParser.html">
<link rel="next" href="WSGML.html">
<link rel="Up" href="index.html">
<link title="Index of types" rel=Appendix href="index_types.html">
<link title="Index of exceptions" rel=Appendix href="index_exceptions.html">
<link title="Index of values" rel=Appendix href="index_values.html">
<link title="Index of class methods" rel=Appendix href="index_methods.html">
<link title="Index of class types" rel=Appendix href="index_class_types.html">
<link title="Index of modules" rel=Appendix href="index_modules.html">
<link title="Index of module types" rel=Appendix href="index_module_types.html">
<link title="Unicode" rel="Chapter" href="Unicode.html">
<link title="SysExits" rel="Chapter" href="SysExits.html">
<link title="Getopt" rel="Chapter" href="Getopt.html">
<link title="ConfigurationMap" rel="Chapter" href="ConfigurationMap.html">
<link title="Generic_component" rel="Chapter" href="Generic_component.html">
<link title="Generic_type" rel="Chapter" href="Generic_type.html">
<link title="Generic_message" rel="Chapter" href="Generic_message.html">
<link title="Generic_diagnostic" rel="Chapter" href="Generic_diagnostic.html">
<link title="Generic_asset" rel="Chapter" href="Generic_asset.html">
<link title="Generic_application" rel="Chapter" href="Generic_application.html">
<link title="CType" rel="Chapter" href="CType.html">
<link title="CConfigurationMap" rel="Chapter" href="CConfigurationMap.html">
<link title="CMessage" rel="Chapter" href="CMessage.html">
<link title="CApplication" rel="Chapter" href="CApplication.html">
<link title="ConfigurationParser" rel="Chapter" href="ConfigurationParser.html">
<link title="UnitTest" rel="Chapter" href="UnitTest.html">
<link title="WSGML" rel="Chapter" href="WSGML.html">
<link title="WHTML" rel="Chapter" href="WHTML.html">
<link title="LoremIpsum" rel="Chapter" href="LoremIpsum.html"><link title="Simple test cases" rel="Section" href="#6_Simpletestcases">
<link title="Compound test cases" rel="Section" href="#6_Compoundtestcases">
<link title="Examining test cases" rel="Section" href="#6_Examiningtestcases">
<link title="Test fixtures" rel="Section" href="#6_Testfixtures">
<link title="Test suites" rel="Section" href="#6_Testsuites">
<link title="Supervisors" rel="Section" href="#6_Supervisors">
<link title="Managing tests" rel="Section" href="#6_Managingtests">
<title>Gasoline library : UnitTest</title>
</head>
<body>
<div class="navbar"><a class="pre" href="ConfigurationParser.html" title="ConfigurationParser">Previous</a>
&nbsp;<a class="up" href="index.html" title="Index">Up</a>
&nbsp;<a class="post" href="WSGML.html" title="WSGML">Next</a>
</div>
<h1>Module <a href="type_UnitTest.html">UnitTest</a></h1>

<pre><span class="keyword">module</span> UnitTest: <code class="code">sig</code> <a href="UnitTest.html">..</a> <code class="code">end</code></pre><div class="info module top">
Unit testing.
<p>

This <i>unit test framework</i> supports <i>test automation, sharing
of setup and teardown code</i> for tests and <i>aggregation of tests in
collections</i>.
<p>

To achieve this, we support some important concepts:
<p>

<b>Test case.</b>
A test case is the smallest unit of testing.  It usually compares an
expected behaviour with the actual behaviour for a particular set of
inputs.
<p>

<b>Test outcome.</b>
A test outcome represents the result of a test case, <i>i.e.</i> if the
actual behaviour matches the expected behaviour.
<p>

<b>Test fixture.</b>
A test fixture represents the preparation needed to perform one or
more test cases, and any associated cleanup actions.  This may
involve, for example, creating temporary directories, logging into a
database, or starting a server process.
<p>

<b>Test suite.</b>
A test suite is a collection of test cases, test suites, or
both.  It is used to aggregate tests that should be executed
together, for instance, the tests for a given component.
<p>

<b>Test supervisor.</b>
A test supervisor is a component which orchestrates the execution of
tests and provides the outcome to the user.  The supervisor may use a
graphical interface, a textual interface, or return a special value to
indicate the results of executing the tests.<br>
</div>
<hr width="100%">

<pre><span id="TYPEt"><span class="keyword">type</span> <code class="type"></code>t</span> </pre>
<div class="info ">
The abstract type of test cases.<br>
</div>


<pre><span id="TYPEprinter"><span class="keyword">type</span> <code class="type">'a</code> printer</span> = <code class="type">Format.formatter -> 'a -> unit</code> </pre>
<div class="info ">
The type of printers for values of type <code class="code">'a</code>.<br>
</div>

<br>
<h6 id="6_Simpletestcases">Simple test cases</h6><br>

<pre><span id="VALassert_success"><span class="keyword">val</span> assert_success</span> : <code class="type">string -> <a href="UnitTest.html#TYPEt">t</a></code></pre><div class="info ">
A test case that always succeeds, the string identifies the test case.<br>
</div>

<pre><span id="VALassert_failure"><span class="keyword">val</span> assert_failure</span> : <code class="type">string -> <a href="UnitTest.html#TYPEt">t</a></code></pre><div class="info ">
A test case that always fails, the string identifies the test case.<br>
</div>

<pre><span id="VALassert_equal"><span class="keyword">val</span> assert_equal</span> : <code class="type">string -><br>       ?expected_failure:bool -><br>       ?printer:'b <a href="UnitTest.html#TYPEprinter">printer</a> -><br>       ?equal:('b -> 'b -> bool) -> ('a -> 'b) -> 'a -> 'b -> <a href="UnitTest.html#TYPEt">t</a></code></pre><div class="info ">
<code class="code">assert_equal ident f x y</code> creates a test case computing <code class="code">f x</code> and comparing
the returned value with <code class="code">y</code>.  The test case succeeds if these values
are equal and fails otherwise.
<p>

Diagnostic messages can be emitted to <code class="code">stdout</code>, they are gathered
by the test supervisor orchestrating the execution of the test case.
Use of the <code class="code">Format</code> module is encouraged.<br>
</div>
<div class="param_info"><code class="code">printer</code> : Printer function used to output values.</div>
<div class="param_info"><code class="code">equal</code> : Predicate used to compare values (defaults to polymorphic <code class="code">=</code>).</div>

<pre><span id="VALassert_true"><span class="keyword">val</span> assert_true</span> : <code class="type">string -> ?expected_failure:bool -> ('a -> bool) -> 'a -> <a href="UnitTest.html#TYPEt">t</a></code></pre><div class="info ">
Specialised version of <code class="code">assert_equal</code> for <code class="code">true</code>.<br>
</div>

<pre><span id="VALassert_false"><span class="keyword">val</span> assert_false</span> : <code class="type">string -> ?expected_failure:bool -> ('a -> bool) -> 'a -> <a href="UnitTest.html#TYPEt">t</a></code></pre><div class="info ">
Specialised version of <code class="code">assert_equal</code> for <code class="code">false</code>.<br>
</div>

<pre><span id="VALassert_for_all"><span class="keyword">val</span> assert_for_all</span> : <code class="type">string -><br>       ?expected_failure:bool -><br>       ?printer:'a <a href="UnitTest.html#TYPEprinter">printer</a> -> ('a -> bool) -> 'a list -> <a href="UnitTest.html#TYPEt">t</a></code></pre><div class="info ">
<code class="code">assert_for_all ident predicate list</code> creates a test case
verifying that all the elements of <code class="code">list</code> pass the predicate.<br>
</div>
<div class="param_info"><code class="code">printer</code> : Printer function used to output values.</div>

<pre><span id="VALassert_exists"><span class="keyword">val</span> assert_exists</span> : <code class="type">string -><br>       ?expected_failure:bool -><br>       ?printer:'a <a href="UnitTest.html#TYPEprinter">printer</a> -> ('a -> bool) -> 'a list -> <a href="UnitTest.html#TYPEt">t</a></code></pre><div class="info ">
<code class="code">assert_for_all ident predicate list</code> creates a test case
verifying that at least one element of <code class="code">list</code> passes the predicate.<br>
</div>
<div class="param_info"><code class="code">printer</code> : Printer function used to output values.</div>

<pre><span id="VALassert_string"><span class="keyword">val</span> assert_string</span> : <code class="type">string -><br>       ?expected_failure:bool -> ('a -> string) -> 'a -> string -> <a href="UnitTest.html#TYPEt">t</a></code></pre><div class="info ">
Specialised version of <code class="code">assert_equal</code> for strings.<br>
</div>

<pre><span id="VALassert_int"><span class="keyword">val</span> assert_int</span> : <code class="type">string -> ?expected_failure:bool -> ('a -> int) -> 'a -> int -> <a href="UnitTest.html#TYPEt">t</a></code></pre><div class="info ">
Specialised version of <code class="code">assert_equal</code> for integers.<br>
</div>

<pre><span id="VALassert_zero"><span class="keyword">val</span> assert_zero</span> : <code class="type">string -> ?expected_failure:bool -> ('a -> int) -> 'a -> <a href="UnitTest.html#TYPEt">t</a></code></pre><div class="info ">
Specialised version of <code class="code">assert_equal</code> for <code class="code">0</code>.<br>
</div>

<pre><span id="VALassert_nonzero"><span class="keyword">val</span> assert_nonzero</span> : <code class="type">string -> ?expected_failure:bool -> ('a -> int) -> 'a -> <a href="UnitTest.html#TYPEt">t</a></code></pre><div class="info ">
A test case similar to <code class="code">assert_equal</code>, testing for a non zero result.<br>
</div>

<pre><span id="VALassert_float"><span class="keyword">val</span> assert_float</span> : <code class="type">string -><br>       ?expected_failure:bool -> ('a -> float) -> 'a -> float -> <a href="UnitTest.html#TYPEt">t</a></code></pre><div class="info ">
A test case similar to <code class="code">assert_equal</code>, testing for a floating
point result being close from an expected value.<br>
</div>

<pre><span id="VALassert_precision"><span class="keyword">val</span> assert_precision</span> : <code class="type">string -><br>       ?expected_failure:bool -> int -> ('a -> float) -> 'a -> float -> <a href="UnitTest.html#TYPEt">t</a></code></pre><div class="info ">
A test case similar to <code class="code">assert_float</code>, testing for a floating
point result being close from an expected value with a given
precision.<br>
</div>

<pre><span id="VALassert_exception"><span class="keyword">val</span> assert_exception</span> : <code class="type">string -> ?expected_failure:bool -> exn -> ('a -> 'b) -> 'a -> <a href="UnitTest.html#TYPEt">t</a></code></pre><div class="info ">
A test case that succeeds only when the computed function raises the
given exception.<br>
</div>
<br>
<h6 id="6_Compoundtestcases">Compound test cases</h6><br>

<pre><span id="VALfor_all"><span class="keyword">val</span> for_all</span> : <code class="type">string -> ?expected_failure:bool -> <a href="UnitTest.html#TYPEt">t</a> list -> <a href="UnitTest.html#TYPEt">t</a></code></pre><div class="info ">
A test case succeeding only if all the tests in the given list do.
The string identifies the test case.<br>
</div>

<pre><span id="VALexists"><span class="keyword">val</span> exists</span> : <code class="type">string -> ?expected_failure:bool -> <a href="UnitTest.html#TYPEt">t</a> list -> <a href="UnitTest.html#TYPEt">t</a></code></pre><div class="info ">
A test case succeeding only if one of the tests in the given list does.
The string identifies the test case.<br>
</div>
<br>
<h6 id="6_Examiningtestcases">Examining test cases</h6><br>

<pre><span id="VALident"><span class="keyword">val</span> ident</span> : <code class="type"><a href="UnitTest.html#TYPEt">t</a> -> string</code></pre><div class="info ">
The string identifying a test case.<br>
</div>
<br>
<h6 id="6_Testfixtures">Test fixtures</h6><br>

<pre><span id="TYPEfixture"><span class="keyword">type</span> <code class="type"></code>fixture</span> </pre>
<div class="info ">
The abstract type of test fixtures.<br>
</div>


<pre><span id="VALmake_fixture"><span class="keyword">val</span> make_fixture</span> : <code class="type">(unit -> unit) -> (unit -> unit) -> <a href="UnitTest.html#TYPEfixture">fixture</a></code></pre><div class="info ">
<code class="code">make_fixture setup tear_down</code> creates a test fixture running <code class="code">setup</code>
before a test and <code class="code">tear_down</code> after its complextion, successful or
not.<br>
</div>

<pre><span id="VALrelax"><span class="keyword">val</span> relax</span> : <code class="type"><a href="UnitTest.html#TYPEfixture">fixture</a></code></pre><div class="info ">
A trivial test fixture, doing nothing.<br>
</div>

<pre><span id="VALtmpfile"><span class="keyword">val</span> tmpfile</span> : <code class="type">string -> string -> string Pervasives.ref -> <a href="UnitTest.html#TYPEfixture">fixture</a></code></pre><div class="info ">
A test fixture creating a temporary file before running the test and
deleting it after test completion.
<p>

<code class="code">tmpfile prefix suffix r</code> creates a temporary file whose name is
derivated from the concatenation of <code class="code">prefix</code>, some appropriate
random number and a <code class="code">suffix</code>.  This name is stored in the
reference <code class="code">r</code>.
<p>

The temporary file is created empty, with permissions <code class="code">0o600</code>
(readable and writable only by the file owner). The file is
guaranteed to be different from any other file that existed when
<code class="code">tmpfile</code> was called.<br>
<b>Raises</b> <code>Sys_error</code> if the file could not be created.<br>
</div>

<pre><span id="VALtmpdir"><span class="keyword">val</span> tmpdir</span> : <code class="type">string -> string -> string Pervasives.ref -> <a href="UnitTest.html#TYPEfixture">fixture</a></code></pre><div class="info ">
A test fixture creating a temporary directory and making it the current
working directory before running the test and moving back to the previous
current working directory then deleting the temporary directory after test
completion.<br>
</div>
<br>
<h6 id="6_Testsuites">Test suites</h6><br>

<pre><span id="TYPEsuite"><span class="keyword">type</span> <code class="type"></code>suite</span> </pre>
<div class="info ">
The abstract type of test suites.<br>
</div>


<pre><span id="VALmake"><span class="keyword">val</span> make</span> : <code class="type">?fixture:<a href="UnitTest.html#TYPEfixture">fixture</a> -><br>       ?init:(<a href="UnitTest.html#TYPEsuite">suite</a> -> unit) -> string -> <a href="UnitTest.html#TYPEsuite">suite</a></code></pre><div class="info ">
Create a test suite, identified by the string.  If given, the
fixture applies to the test suite as a whole.<br>
</div>

<pre><span id="VALadd_case"><span class="keyword">val</span> add_case</span> : <code class="type">?fixture:<a href="UnitTest.html#TYPEfixture">fixture</a> -> <a href="UnitTest.html#TYPEsuite">suite</a> -> <a href="UnitTest.html#TYPEt">t</a> -> unit</code></pre><div class="info ">
Add a test case to a test suite.<br>
</div>

<pre><span id="VALadd_suite"><span class="keyword">val</span> add_suite</span> : <code class="type">?fixture:<a href="UnitTest.html#TYPEfixture">fixture</a> -> <a href="UnitTest.html#TYPEsuite">suite</a> -> <a href="UnitTest.html#TYPEsuite">suite</a> -> unit</code></pre><div class="info ">
Add a test suite to a test suite.<br>
</div>

<pre><span id="VALadd_challenge"><span class="keyword">val</span> add_challenge</span> : <code class="type"><a href="UnitTest.html#TYPEsuite">suite</a> -> ('a -> <a href="UnitTest.html#TYPEt">t</a>) -> 'a list -> unit</code></pre><div class="info ">
<code class="code">add_challenge suite f c</code> prepare a list of test cases by mapping <code class="code">f</code>
    over <code class="code">c</code> and add them to <code class="code">suite</code>.
<p>

    This can be used to prepare a large amount of test cases out of
    static data.<br>
</div>
<br>
<h6 id="6_Supervisors">Supervisors</h6><br>

<pre><span id="TYPEsupervisor"><span class="keyword">type</span> <code class="type"></code>supervisor</span> </pre>
<div class="info ">
The abstract type of test supervisors.<br>
</div>


<pre><span id="VALverbose"><span class="keyword">val</span> verbose</span> : <code class="type"><a href="UnitTest.html#TYPEsupervisor">supervisor</a></code></pre><div class="info ">
A simple supervisor printing a lot of details on stdout and
terminating with a summary on stderr.<br>
</div>

<pre><span id="VALconcise"><span class="keyword">val</span> concise</span> : <code class="type"><a href="UnitTest.html#TYPEsupervisor">supervisor</a></code></pre><div class="info ">
A simple supervisor printing only details pertaining to test
failures on stderr.
<p>

A log file is prepared from the standard output of the given
test suite.<br>
</div>

<pre><span id="VALnot_implemented"><span class="keyword">val</span> not_implemented</span> : <code class="type">unit -> unit</code></pre><div class="info ">
Used by test case code to signal its supervisor that a feature is
not yet implemented.<br>
</div>

<pre><span id="VALskip_if"><span class="keyword">val</span> skip_if</span> : <code class="type">bool -> unit</code></pre><div class="info ">
Used by test case code to signal its supervisor that a test should
not be performed if the given condition is met.<br>
</div>

<pre><span id="VALonly_for"><span class="keyword">val</span> only_for</span> : <code class="type">bool -> unit</code></pre><div class="info ">
Used by test case code to signal its supervisor that a test should
only be performed when the given condition is met.
<p>

This is equivalent to <code class="code">skip_if</code> with a negated condition.<br>
</div>
<br>
<h6 id="6_Managingtests">Managing tests</h6><br>

<pre><span id="VALregister"><span class="keyword">val</span> register</span> : <code class="type">?prerequisite:string list -> <a href="UnitTest.html#TYPEsuite">suite</a> -> unit</code></pre><div class="info ">
Register a test suite.<br>
</div>

<pre><span id="VALpackage"><span class="keyword">val</span> package</span> : <code class="type">?prerequisite:string list -> string * string list -> unit</code></pre><div class="info ">
<code class="code">package (name,subsuite)</code> create an register a test suite called
<code class="code">name</code> containing the test suites listed in <code class="code">subsuite</code>.<br>
<b>Raises</b><ul><li><code>Failure</code> if some prerequisite is not registered.</li>
<li><code>Failure</code> is one of the subsuite is not known.</li>
</ul>
</div>

<pre><span id="VALwith_registered_suite"><span class="keyword">val</span> with_registered_suite</span> : <code class="type">?fixture:<a href="UnitTest.html#TYPEfixture">fixture</a> -><br>       ?prerequisite:string list -> string -> (<a href="UnitTest.html#TYPEsuite">suite</a> -> unit) -> unit</code></pre><div class="info ">
<code class="code">with_registered_suite name init</code> apply <code class="code">init</code> on a fresh new,
registered suite, called <code class="code">name</code>.<br>
<b>Raises</b> <code>Failure</code> if some prerequisite is not registered.<br>
</div>

<pre><span id="VALlist_expected_failures"><span class="keyword">val</span> list_expected_failures</span> : <code class="type">unit -> string list</code></pre><div class="info ">
List test cases which are expected to fail.<br>
</div>

<pre><span id="VALlist_suites"><span class="keyword">val</span> list_suites</span> : <code class="type">unit -> string list</code></pre><div class="info ">
List available test suites.<br>
</div>

<pre><span id="VALrun"><span class="keyword">val</span> run</span> : <code class="type">?supervisor:<a href="UnitTest.html#TYPEsupervisor">supervisor</a> -> string -> bool</code></pre><div class="info ">
Run the given test suite. The return value indicates the success
of the test suites, that is, if each test either returned
<code class="code">Success</code> or <code class="code">Skipped</code>.<br>
</div>

<pre><span id="VALrun_all"><span class="keyword">val</span> run_all</span> : <code class="type">?supervisor:<a href="UnitTest.html#TYPEsupervisor">supervisor</a> -> unit -> bool</code></pre><div class="info ">
Run all available test suites.<br>
</div>

<pre><span id="VALmain"><span class="keyword">val</span> main</span> : <code class="type">unit -> unit</code></pre><div class="info ">
Main procedure for unitary tests.  It analyses the command line
and performs the appropriate actions.<br>
</div>
</body></html>