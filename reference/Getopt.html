<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<link rel="stylesheet" href="style.css" type="text/css">
<meta content="text/html; charset=utf-8" http-equiv="Content-Type">
<link rel="Start" href="index.html">
<link rel="previous" href="SysExits.html">
<link rel="next" href="ConfigurationMap.html">
<link rel="Up" href="index.html">
<link title="Index of types" rel=Appendix href="index_types.html">
<link title="Index of exceptions" rel=Appendix href="index_exceptions.html">
<link title="Index of values" rel=Appendix href="index_values.html">
<link title="Index of class methods" rel=Appendix href="index_methods.html">
<link title="Index of class types" rel=Appendix href="index_class_types.html">
<link title="Index of modules" rel=Appendix href="index_modules.html">
<link title="Index of module types" rel=Appendix href="index_module_types.html">
<link title="Unicode" rel="Chapter" href="Unicode.html">
<link title="SysExits" rel="Chapter" href="SysExits.html">
<link title="Getopt" rel="Chapter" href="Getopt.html">
<link title="ConfigurationMap" rel="Chapter" href="ConfigurationMap.html">
<link title="Generic_component" rel="Chapter" href="Generic_component.html">
<link title="Generic_type" rel="Chapter" href="Generic_type.html">
<link title="Generic_message" rel="Chapter" href="Generic_message.html">
<link title="Generic_diagnostic" rel="Chapter" href="Generic_diagnostic.html">
<link title="Generic_asset" rel="Chapter" href="Generic_asset.html">
<link title="Generic_application" rel="Chapter" href="Generic_application.html">
<link title="CType" rel="Chapter" href="CType.html">
<link title="CConfigurationMap" rel="Chapter" href="CConfigurationMap.html">
<link title="CMessage" rel="Chapter" href="CMessage.html">
<link title="CApplication" rel="Chapter" href="CApplication.html">
<link title="ConfigurationParser" rel="Chapter" href="ConfigurationParser.html">
<link title="UnitTest" rel="Chapter" href="UnitTest.html">
<link title="WSGML" rel="Chapter" href="WSGML.html">
<link title="WHTML" rel="Chapter" href="WHTML.html">
<link title="LoremIpsum" rel="Chapter" href="LoremIpsum.html"><link title="How program arguments are read" rel="Section" href="#1_Howprogramargumentsareread">
<link title="Traditional flags and options" rel="Subsection" href="#6_Traditionalflagsandoptions">
<link title="Help notes" rel="Subsection" href="#6_Helpnotes">
<link title="Command line processing specifications" rel="Subsection" href="#6_Commandlineprocessingspecifications">
<link title="Help screen" rel="Subsection" href="#6_Helpscreen">
<link title="Parse command options" rel="Subsection" href="#6_Parsecommandoptions">
<link title="Long options" rel="Subsection" href="#6_Longoptions">
<link title="Creating callbacks" rel="Subsection" href="#6_Creatingcallbacks">
<title>Gasoline library : Getopt</title>
</head>
<body>
<div class="navbar"><a class="pre" href="SysExits.html" title="SysExits">Previous</a>
&nbsp;<a class="up" href="index.html" title="Index">Up</a>
&nbsp;<a class="post" href="ConfigurationMap.html" title="ConfigurationMap">Next</a>
</div>
<h1>Module <a href="type_Getopt.html">Getopt</a></h1>

<pre><span class="keyword">module</span> Getopt: <code class="code">sig</code> <a href="Getopt.html">..</a> <code class="code">end</code></pre><div class="info module top">
Processing the command line
<p>

The <code class="code">Getopt</code> module is used to break up options in command lines and
interpret them.  It supports the canonical UNIX convention, long
options and long arguments.<br>
</div>
<hr width="100%">
<br>
<h1 id="1_Howprogramargumentsareread">How program arguments are read</h1>
<p>

In this module, the argument vector passed to the process by <i>execve(2)</i> is broken up into the following pieces: the executable
name, the sequence of flags and options, then the sequence of main
arguments.
<p>

Instead of giving a formal definition of the rules used to analyze the
command line, we illustrate it agains a few examples. We assume that
the program accepts the flags <code class="code">'h'</code>, <code class="code">'v'</code> and <code class="code">'a'</code>, and the options
<code class="code">'o'</code> and <code class="code">'m'</code>. Now let us see how some arguments vectors are broken
up into pieces:
<p>
<ul>
<li><code class="code">program -v -o output input</code> is understood as <i>the flag v </i>,
  <i>the option o with the argument "output"</i> and
  <i>the rest argument "input"</i>;</li>
<li><code class="code">program -vo output input</code> and <code class="code">program -vooutput input</code> are analyzed the
  same way, since flag clustering is allowed;</li>
<li><code class="code">program -ovoutput input</code> is understood as <i>the option o with the
  argument "voutput"</i> and <i>the main argument "input"</i>.</li>
</ul>

Some programs, as <i>gcc</i> or <i>clang</i>, use a flag to introduce <i>key/value</i> style options, as in
<code class="code">clang -march=CPU -mmacosx-version-min=10.6</code>.  This scheme is also
supported by this module, see <i>long options</i>.
<p>

While the procedures defined in this module allows a program to deal
with its argument as most of the UNIX programs do, there is many
schemes not supported by it. Among these are<ul>
<li>tar style, where flags and options are grouped together and the
  arguments come later;</li>
<li>sox style, where options affect only the file preceding them;</li>
<li>svn style, where the svn program multiplexes many programs in one.</li>
</ul>
<br>
<br>
<h6 id="6_Traditionalflagsandoptions">Traditional flags and options</h6><br>

<pre><span id="TYPEt"><span class="keyword">type</span> <code class="type"></code>t</span> </pre>
<div class="info ">
<em>That getopt thingie</em> <code class="code">t</code> represents a flag or an option.
<p>

Values of this type are created by the functions
<code class="code">flag</code>, <code class="code">char</code>, <code class="code">bool</code>, <code class="code">string</code>, <code class="code">int</code> and <code class="code">float</code> hereafter, their
variants <code class="code">set_flag</code>, <code class="code">set_char</code>, <code class="code">set_bool</code>, <code class="code">set_string</code>, <code class="code">set_int</code>
and <code class="code">set_float</code>, and the <code class="code">long</code> forging long options.<br>
</div>


<pre><span id="TYPEreader"><span class="keyword">type</span> <code class="type">'a</code> reader</span> = <code class="type">string -> 'a</code> </pre>
<div class="info ">
The type of functions converting <code class="code">string</code> to <code class="code">'a</code>.  Such a
function can raise <code class="code">Failure</code> (preferred) or <code class="code">Invalid_arg</code> to indicate
an ill-formed input.<br>
</div>


<pre><span id="VALflag"><span class="keyword">val</span> flag</span> : <code class="type">char -> (unit -> unit) -> string -> <a href="Getopt.html#TYPEt">t</a></code></pre><div class="info ">
<code class="code">char c f d</code> constructs a <code class="code">t</code> that handles the flag denoted by
<code class="code">c</code>. When this flag occurs in the command line, the callback <code class="code">f</code> is
called. The message <code class="code">d</code> may be displayed in the
help screen of the program.<br>
</div>

<pre><span id="VALchar"><span class="keyword">val</span> char</span> : <code class="type">char -> (char -> unit) -> string -> <a href="Getopt.html#TYPEt">t</a></code></pre><div class="info ">
<code class="code">char c f d</code> constructs a <code class="code">t</code> that handles the option denoted by
<code class="code">c</code>. This options has a <code class="code">char</code> value as argument. When this option
occurs in the command line, the callback <code class="code">f</code> is called on the option
argument. The message <code class="code">d</code> may be displayed in the help screen of the
program.<br>
</div>

<pre><span id="VALbool"><span class="keyword">val</span> bool</span> : <code class="type">char -> (bool -> unit) -> string -> <a href="Getopt.html#TYPEt">t</a></code></pre><div class="info ">
Similar to <code class="code">char</code> for boolean values.<br>
</div>

<pre><span id="VALstring"><span class="keyword">val</span> string</span> : <code class="type">char -> (string -> unit) -> string -> <a href="Getopt.html#TYPEt">t</a></code></pre><div class="info ">
Similar to <code class="code">char</code> for string values.<br>
</div>

<pre><span id="VALint"><span class="keyword">val</span> int</span> : <code class="type">char -> (int -> unit) -> string -> <a href="Getopt.html#TYPEt">t</a></code></pre><div class="info ">
Similar to <code class="code">char</code> for integer values.<br>
</div>

<pre><span id="VALfloat"><span class="keyword">val</span> float</span> : <code class="type">char -> (float -> unit) -> string -> <a href="Getopt.html#TYPEt">t</a></code></pre><div class="info ">
Similar to <code class="code">char</code> for floating point values.<br>
</div>

<pre><span id="VALconcrete"><span class="keyword">val</span> concrete</span> : <code class="type">'a <a href="Getopt.html#TYPEreader">reader</a> -> char -> ('a -> unit) -> string -> <a href="Getopt.html#TYPEt">t</a></code></pre><div class="info ">
<code class="code">concrete conc c f d</code> constructs a <code class="code">t</code> that handles the option
denoted by <code class="code">c</code>. This options has a <code class="code">'a</code> value as argument converted
from the given string by <code class="code">conc</code>.  When this option occurs in the
command line, the callback <code class="code">f</code> is called on the option argument. The
message <code class="code">d</code> may be displayed in the help screen of the program.<br>
</div>
<br>
<h6 id="6_Helpnotes">Help notes</h6><br>

<pre><span id="TYPEnote"><span class="keyword">type</span> <code class="type"></code>note</span> </pre>
<div class="info ">
A <code class="code">note</code> is a message that shall be displayed when the user asks
for the help screen of the program. Such a message has a title and a
body, which is broken down into paragraphs.<br>
</div>


<pre><span id="VALnote"><span class="keyword">val</span> note</span> : <code class="type">string -> string -> <a href="Getopt.html#TYPEnote">note</a></code></pre><div class="info ">
<code class="code">note title body</code> constructs a <code class="code">note</code>. In the <code class="code">body</code>, paragraphs
are separated by end-of-line characters.<br>
</div>
<br>
<h6 id="6_Commandlineprocessingspecifications">Command line processing specifications</h6><br>

<pre><span id="TYPEspec"><span class="keyword">type</span> <code class="type"></code>spec</span> </pre>
<div class="info ">
The abstract type of command line processing specifications.
<p>

Such a specification is made up of flags and notes.<br>
</div>


<pre><span id="VALspec"><span class="keyword">val</span> spec</span> : <code class="type">string -><br>       string -><br>       <a href="Getopt.html#TYPEt">t</a> list -> (string -> unit) -> <a href="Getopt.html#TYPEnote">note</a> list -> <a href="Getopt.html#TYPEspec">spec</a></code></pre><div class="info ">
<code class="code">spec usage description options rest notes</code> builds an environment
for command line analysis.<br>
</div>
<br>
<h6 id="6_Helpscreen">Help screen</h6><br>

<pre><span id="VALhelp"><span class="keyword">val</span> help</span> : <code class="type"><a href="Getopt.html#TYPEspec">spec</a> -> unit</code></pre><div class="info ">
Output the help screen associated to the analysis specification
and terminate the application.<br>
</div>

<pre><span id="VALusage"><span class="keyword">val</span> usage</span> : <code class="type"><a href="Getopt.html#TYPEspec">spec</a> -> string -> unit</code></pre><div class="info ">
Output a message and the usage associated to the analysis specification
and terminate the application with exit code 64.<br>
</div>
<br>
<h6 id="6_Parsecommandoptions">Parse command options</h6><br>

<pre><span id="VALparse"><span class="keyword">val</span> parse</span> : <code class="type"><a href="Getopt.html#TYPEspec">spec</a> -> string array -> unit</code></pre><div class="info ">
<code class="code">parse</code> uses an environment to analyse an argument vector.<br>
</div>

<pre><span id="VALparse_argv"><span class="keyword">val</span> parse_argv</span> : <code class="type"><a href="Getopt.html#TYPEspec">spec</a> -> unit</code></pre><div class="info ">
This is a specialisation of <code class="code">parse</code> to the process arguments
vector.<br>
</div>
<br>
<h6 id="6_Longoptions">Long options</h6><br>

<pre><span id="TYPElong_option"><span class="keyword">type</span> <code class="type"></code>long_option</span> </pre>
<div class="info ">
The type of long options.  Several long options can be packed
together to be multiplexed by a traditional short option.<br>
</div>


<pre><span id="VALlong"><span class="keyword">val</span> long</span> : <code class="type">char -> <a href="Getopt.html#TYPElong_option">long_option</a> list -> string -> <a href="Getopt.html#TYPEt">t</a></code></pre><div class="info ">
<code class="code">long flag longopt_list description</code> constructs a short option
multiplexing a load of long options.<br>
</div>

<pre><span id="VALlong_flag"><span class="keyword">val</span> long_flag</span> : <code class="type">string -> (unit -> unit) -> <a href="Getopt.html#TYPElong_option">long_option</a></code></pre><div class="info ">
<code class="code">long_flag name cb</code> create a long option flag named <code class="code">name</code>
triggering the callback <code class="code">cb</code>.<br>
</div>

<pre><span id="VALlong_char"><span class="keyword">val</span> long_char</span> : <code class="type">string -> (char -> unit) -> <a href="Getopt.html#TYPElong_option">long_option</a></code></pre><div class="info ">
<code class="code">long_flag name cb</code> create a long optionan argument named <code class="code">name</code>
requiring a character argument and triggering the callback <code class="code">cb</code>.<br>
</div>

<pre><span id="VALlong_bool"><span class="keyword">val</span> long_bool</span> : <code class="type">string -> (bool -> unit) -> <a href="Getopt.html#TYPElong_option">long_option</a></code></pre><div class="info ">
Similar to <code class="code">long_char</code> for boolean values.<br>
</div>

<pre><span id="VALlong_string"><span class="keyword">val</span> long_string</span> : <code class="type">string -> (string -> unit) -> <a href="Getopt.html#TYPElong_option">long_option</a></code></pre><div class="info ">
Similar to <code class="code">long_char</code> for string values.<br>
</div>

<pre><span id="VALlong_int"><span class="keyword">val</span> long_int</span> : <code class="type">string -> (int -> unit) -> <a href="Getopt.html#TYPElong_option">long_option</a></code></pre><div class="info ">
Similar to <code class="code">long_char</code> for integer values.<br>
</div>

<pre><span id="VALlong_float"><span class="keyword">val</span> long_float</span> : <code class="type">string -> (float -> unit) -> <a href="Getopt.html#TYPElong_option">long_option</a></code></pre><div class="info ">
Similar to <code class="code">long_char</code> for floating point values.<br>
</div>

<pre><span id="VALlong_concrete"><span class="keyword">val</span> long_concrete</span> : <code class="type">'a <a href="Getopt.html#TYPEreader">reader</a> -> string -> ('a -> unit) -> <a href="Getopt.html#TYPElong_option">long_option</a></code></pre><div class="info ">
Similar to <code class="code">long_char</code> for arbitrary values.<br>
</div>
<br>
<h6 id="6_Creatingcallbacks">Creating callbacks</h6><br>

<pre><span id="VALstore"><span class="keyword">val</span> store</span> : <code class="type">'a Pervasives.ref -> 'a -> unit</code></pre><div class="info ">
<code class="code">store r v</code> is the same as <code class="code">r := v</code> and can be partially evaluated
to form a callback.<br>
</div>

<pre><span id="VALset"><span class="keyword">val</span> set</span> : <code class="type">'a -> 'a Pervasives.ref -> unit -> unit</code></pre><div class="info ">
<code class="code">set v r ()</code> is the same as <code class="code">r := v</code> and and can be partially evaluated
to form a callback.<br>
</div>

<pre><span id="VALqueue"><span class="keyword">val</span> queue</span> : <code class="type">'a list Pervasives.ref -> 'a -> unit</code></pre><div class="info ">
<code class="code">queue a v</code> add <code class="code">v</code> at the end of <code class="code">!a</code>. It can be partially
evaluated to form a callback.<br>
</div>
</body></html>